{"ast":null,"code":"import _toConsumableArray from \"C:/Users/mohsh/Downloads/chat-app-master (1)/chat-app-master/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"C:/Users/mohsh/Downloads/chat-app-master (1)/chat-app-master/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"C:/Users/mohsh/Downloads/chat-app-master (1)/chat-app-master/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:/Users/mohsh/Downloads/chat-app-master (1)/chat-app-master/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:/Users/mohsh/Downloads/chat-app-master (1)/chat-app-master/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:/Users/mohsh/Downloads/chat-app-master (1)/chat-app-master/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:/Users/mohsh/Downloads/chat-app-master (1)/chat-app-master/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Users\\\\mohsh\\\\Downloads\\\\chat-app-master (1)\\\\chat-app-master\\\\web\\\\src\\\\views\\\\Chat.js\";\nimport React from 'react';\nimport { Row, Spinner } from 'reactstrap';\nimport { ContactHeader, Contacts, ChatHeader, Messages, MessageForm, UserProfile, EditProfile } from 'components';\nimport socketIO from 'socket.io-client';\nimport Auth from 'Auth';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar Chat = /*#__PURE__*/function (_React$Component) {\n  _inherits(Chat, _React$Component);\n\n  var _super = _createSuper(Chat);\n\n  function Chat() {\n    var _this;\n\n    _classCallCheck(this, Chat);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      contacts: [],\n      contact: {},\n      userProfile: false,\n      profile: false,\n      connected: false,\n      messages: [],\n      typing: false,\n      timeout: null,\n      user: null\n    };\n\n    _this.initiateCall = function (contact) {\n      console.log('Initiating call with:', contact); // EXAMPLE: You might emit a \"callUser\" event via Socket.io\n      // or open a modal for WebRTC.\n      // e.g.:\n\n      /*\r\n      if (!contact.id) return;\r\n      this.state.socket.emit('callUser', {\r\n        recipientId: contact.id,\r\n        callerName: this.state.user?.name,\r\n      });\r\n      */\n      // Or put your full WebRTC call setup here.\n    };\n\n    _this.onChatNavigate = function (contact) {\n      _this.setState({\n        contact: contact\n      }); // Mark unseen messages as seen.\n\n\n      _this.state.socket.emit('seen', contact.id);\n\n      var messages = _this.state.messages.map(function (m) {\n        if (m.sender === contact.id) {\n          return _objectSpread(_objectSpread({}, m), {}, {\n            seen: true\n          });\n        }\n\n        return m;\n      });\n\n      _this.setState({\n        messages: messages\n      });\n    };\n\n    _this.userProfileToggle = function () {\n      return _this.setState({\n        userProfile: !_this.state.userProfile\n      });\n    };\n\n    _this.profileToggle = function () {\n      return _this.setState({\n        profile: !_this.state.profile\n      });\n    };\n\n    _this.renderChat = function () {\n      var _this$state = _this.state,\n          contact = _this$state.contact,\n          user = _this$state.user,\n          messages = _this$state.messages;\n      if (!(contact === null || contact === void 0 ? void 0 : contact.id)) return null; // Filter messages for the active contact\n\n      var filtered = messages.filter(function (m) {\n        return m.sender === contact.id || m.receiver === contact.id;\n      });\n      return /*#__PURE__*/_jsxDEV(Messages, {\n        user: user,\n        messages: filtered\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 12\n      }, _assertThisInitialized(_this));\n    };\n\n    _this.initSocketConnection = function () {\n      var socket = socketIO(process.env.REACT_APP_SOCKET, {\n        query: 'token=' + Auth.getToken()\n      });\n      socket.on('connect', function () {\n        return _this.setState({\n          connected: true\n        });\n      });\n      socket.on('disconnect', function () {\n        return _this.setState({\n          connected: false\n        });\n      });\n      socket.on('data', _this.onData);\n      socket.on('new_user', _this.onNewUser);\n      socket.on('update_user', _this.onUpdateUser);\n      socket.on('message', _this.onNewMessage);\n      socket.on('user_status', _this.updateUsersState);\n      socket.on('typing', _this.onTypingMessage);\n      socket.on('error', _this.onSocketError);\n\n      _this.setState({\n        socket: socket\n      });\n    };\n\n    _this.onData = function (user, contacts, messages, users) {\n      var contact = contacts[0] || {};\n\n      _this.setState({\n        messages: messages,\n        contacts: contacts,\n        user: user,\n        contact: contact\n      }, function () {\n        _this.updateUsersState(users);\n      });\n    };\n\n    _this.onNewUser = function (user) {\n      var contacts = [].concat(_toConsumableArray(_this.state.contacts), [user]);\n\n      _this.setState({\n        contacts: contacts\n      });\n    };\n\n    _this.onUpdateUser = function (updatedUser) {\n      var _this$state$user, _this$state$contact;\n\n      // If current user updated, reflect changes\n      if (((_this$state$user = _this.state.user) === null || _this$state$user === void 0 ? void 0 : _this$state$user.id) === updatedUser.id) {\n        _this.setState({\n          user: updatedUser\n        });\n\n        Auth.setUser(updatedUser);\n        return;\n      } // Otherwise, update that user in contacts\n\n\n      var contacts = _this.state.contacts.map(function (c) {\n        return c.id === updatedUser.id ? _objectSpread(_objectSpread({}, updatedUser), {}, {\n          status: c.status\n        }) : c;\n      });\n\n      _this.setState({\n        contacts: contacts\n      }); // If it's the contact being viewed, update it\n\n\n      if (((_this$state$contact = _this.state.contact) === null || _this$state$contact === void 0 ? void 0 : _this$state$contact.id) === updatedUser.id) {\n        _this.setState({\n          contact: updatedUser\n        });\n      }\n    };\n\n    _this.onNewMessage = function (message) {\n      var _this$state$contact2;\n\n      // If the message is from the active contact, mark it seen\n      if (message.sender === ((_this$state$contact2 = _this.state.contact) === null || _this$state$contact2 === void 0 ? void 0 : _this$state$contact2.id)) {\n        _this.setState({\n          typing: false\n        });\n\n        _this.state.socket.emit('seen', _this.state.contact.id);\n\n        message.seen = true;\n      }\n\n      _this.setState(function (prev) {\n        return {\n          messages: [].concat(_toConsumableArray(prev.messages), [message])\n        };\n      });\n    };\n\n    _this.onTypingMessage = function (sender) {\n      var _this$state$contact3;\n\n      if (((_this$state$contact3 = _this.state.contact) === null || _this$state$contact3 === void 0 ? void 0 : _this$state$contact3.id) !== sender) return;\n\n      _this.setState({\n        typing: sender\n      });\n\n      clearTimeout(_this.state.timeout);\n      var timeout = setTimeout(_this.typingTimeout, 3000);\n\n      _this.setState({\n        timeout: timeout\n      });\n    };\n\n    _this.onSocketError = function (err) {\n      if (err === 'auth_error') {\n        Auth.logout();\n\n        _this.props.history.push('/login');\n      }\n    };\n\n    _this.typingTimeout = function () {\n      return _this.setState({\n        typing: false\n      });\n    };\n\n    _this.sendMessage = function (message) {\n      var _this$state$contact4;\n\n      if (!((_this$state$contact4 = _this.state.contact) === null || _this$state$contact4 === void 0 ? void 0 : _this$state$contact4.id)) return;\n      message.receiver = _this.state.contact.id;\n\n      _this.setState(function (prev) {\n        return {\n          messages: [].concat(_toConsumableArray(prev.messages), [message])\n        };\n      });\n\n      _this.state.socket.emit('message', message);\n    };\n\n    _this.sendType = function () {\n      var _this$state$contact5;\n\n      if ((_this$state$contact5 = _this.state.contact) === null || _this$state$contact5 === void 0 ? void 0 : _this$state$contact5.id) {\n        _this.state.socket.emit('typing', _this.state.contact.id);\n      }\n    };\n\n    _this.logout = function () {\n      _this.state.socket.disconnect();\n\n      Auth.logout();\n\n      _this.props.history.push('/');\n    };\n\n    _this.updateUsersState = function (users) {\n      var contacts = _this.state.contacts.map(function (c) {\n        if (users[c.id]) {\n          return _objectSpread(_objectSpread({}, c), {}, {\n            status: users[c.id]\n          });\n        }\n\n        return c;\n      });\n\n      _this.setState({\n        contacts: contacts\n      });\n\n      var contact = _this.state.contact;\n\n      if (users[contact.id]) {\n        contact.status = users[contact.id];\n\n        _this.setState({\n          contact: contact\n        });\n      }\n    };\n\n    return _this;\n  }\n\n  _createClass(Chat, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // Initialize socket.io connection.\n      this.initSocketConnection();\n    }\n    /**\r\n     * 1) Called by <ChatHeader onCall={this.initiateCall}/>\r\n     *    to initiate an audio/video call.\r\n     */\n\n  }, {\n    key: \"render\",\n    value:\n    /**\r\n     * Render chat page\r\n     */\n    function render() {\n      // If socket.io client not connected or data not loaded, show loading spinner.\n      if (!this.state.connected || !this.state.contacts || !this.state.messages) {\n        return /*#__PURE__*/_jsxDEV(Spinner, {\n          id: \"loader\",\n          color: \"success\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 14\n        }, this);\n      }\n\n      return /*#__PURE__*/_jsxDEV(Row, {\n        className: \"h-100\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"contacts-section\",\n          className: \"col-6 col-md-4\",\n          children: [/*#__PURE__*/_jsxDEV(ContactHeader, {\n            user: this.state.user,\n            toggle: this.profileToggle\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(Contacts, {\n            contacts: this.state.contacts,\n            messages: this.state.messages,\n            onChatNavigate: this.onChatNavigate\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(UserProfile, {\n            contact: this.state.contact,\n            toggle: this.userProfileToggle,\n            open: this.state.userProfile\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(EditProfile, {\n            user: this.state.user,\n            toggle: this.profileToggle,\n            open: this.state.profile\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"messages-section\",\n          className: \"col-6 col-md-8\",\n          children: [/*#__PURE__*/_jsxDEV(ChatHeader, {\n            contact: this.state.contact,\n            typing: this.state.typing,\n            toggle: this.userProfileToggle,\n            logout: this.logout // IMPORTANT: pass \"onCall\" to trigger calls from the header\n            ,\n            onCall: this.initiateCall\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 11\n          }, this), this.renderChat(), /*#__PURE__*/_jsxDEV(MessageForm, {\n            sender: this.sendMessage,\n            sendType: this.sendType\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 7\n      }, this);\n    }\n    /**\r\n     * Render messages for current contact.\r\n     */\n\n  }]);\n\n  return Chat;\n}(React.Component);\n\nexport default Chat;","map":{"version":3,"sources":["C:/Users/mohsh/Downloads/chat-app-master (1)/chat-app-master/web/src/views/Chat.js"],"names":["React","Row","Spinner","ContactHeader","Contacts","ChatHeader","Messages","MessageForm","UserProfile","EditProfile","socketIO","Auth","Chat","state","contacts","contact","userProfile","profile","connected","messages","typing","timeout","user","initiateCall","console","log","onChatNavigate","setState","socket","emit","id","map","m","sender","seen","userProfileToggle","profileToggle","renderChat","filtered","filter","receiver","initSocketConnection","process","env","REACT_APP_SOCKET","query","getToken","on","onData","onNewUser","onUpdateUser","onNewMessage","updateUsersState","onTypingMessage","onSocketError","users","updatedUser","setUser","c","status","message","prev","clearTimeout","setTimeout","typingTimeout","err","logout","props","history","push","sendMessage","sendType","disconnect","Component"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { Row, Spinner } from 'reactstrap';\r\nimport { \r\n  ContactHeader, \r\n  Contacts, \r\n  ChatHeader, \r\n  Messages, \r\n  MessageForm, \r\n  UserProfile, \r\n  EditProfile \r\n} from 'components';\r\nimport socketIO from 'socket.io-client';\r\nimport Auth from 'Auth';\r\n\r\nclass Chat extends React.Component {\r\n  state = { \r\n    contacts: [],\r\n    contact: {},\r\n    userProfile: false,\r\n    profile: false,\r\n    connected: false,\r\n    messages: [],\r\n    typing: false,\r\n    timeout: null,\r\n    user: null\r\n  };\r\n\r\n  componentDidMount() {\r\n    // Initialize socket.io connection.\r\n    this.initSocketConnection();\r\n  }\r\n\r\n  /**\r\n   * 1) Called by <ChatHeader onCall={this.initiateCall}/>\r\n   *    to initiate an audio/video call.\r\n   */\r\n  initiateCall = (contact) => {\r\n    console.log('Initiating call with:', contact);\r\n    \r\n    // EXAMPLE: You might emit a \"callUser\" event via Socket.io\r\n    // or open a modal for WebRTC.\r\n    // e.g.:\r\n    /*\r\n    if (!contact.id) return;\r\n    this.state.socket.emit('callUser', {\r\n      recipientId: contact.id,\r\n      callerName: this.state.user?.name,\r\n    });\r\n    */\r\n\r\n    // Or put your full WebRTC call setup here.\r\n  };\r\n\r\n  /**\r\n   * Switch to a different chat contact.\r\n   */\r\n  onChatNavigate = (contact) => {\r\n    this.setState({ contact });\r\n    // Mark unseen messages as seen.\r\n    this.state.socket.emit('seen', contact.id);\r\n    let messages = this.state.messages.map((m) => {\r\n      if (m.sender === contact.id) {\r\n        return { ...m, seen: true };\r\n      }\r\n      return m;\r\n    });\r\n    this.setState({ messages });\r\n  };\r\n\r\n  /**\r\n   * Toggle UserProfile component.\r\n   */\r\n  userProfileToggle = () => this.setState({ userProfile: !this.state.userProfile });\r\n\r\n  /**\r\n   * Toggle EditProfile component.\r\n   */\r\n  profileToggle = () => this.setState({ profile: !this.state.profile });\r\n\r\n  /**\r\n   * Render chat page\r\n   */\r\n  render() {\r\n    // If socket.io client not connected or data not loaded, show loading spinner.\r\n    if (!this.state.connected || !this.state.contacts || !this.state.messages) {\r\n      return <Spinner id=\"loader\" color=\"success\" />;\r\n    }\r\n\r\n    return (\r\n      <Row className=\"h-100\">\r\n        \r\n        {/* LEFT: Contacts Section */}\r\n        <div id=\"contacts-section\" className=\"col-6 col-md-4\">\r\n          <ContactHeader \r\n            user={this.state.user} \r\n            toggle={this.profileToggle} \r\n          />\r\n          <Contacts\r\n            contacts={this.state.contacts}\r\n            messages={this.state.messages}\r\n            onChatNavigate={this.onChatNavigate}\r\n          />\r\n          <UserProfile\r\n            contact={this.state.contact}\r\n            toggle={this.userProfileToggle}\r\n            open={this.state.userProfile}\r\n          />\r\n          <EditProfile\r\n            user={this.state.user}\r\n            toggle={this.profileToggle}\r\n            open={this.state.profile}\r\n          />\r\n        </div>\r\n\r\n        {/* RIGHT: Messages Section */}\r\n        <div id=\"messages-section\" className=\"col-6 col-md-8\">\r\n          <ChatHeader\r\n            contact={this.state.contact}\r\n            typing={this.state.typing}\r\n            toggle={this.userProfileToggle}\r\n            logout={this.logout}\r\n            // IMPORTANT: pass \"onCall\" to trigger calls from the header\r\n            onCall={this.initiateCall}\r\n          />\r\n          {this.renderChat()}\r\n          <MessageForm sender={this.sendMessage} sendType={this.sendType} />\r\n        </div>\r\n      </Row>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Render messages for current contact.\r\n   */\r\n  renderChat = () => {\r\n    const { contact, user, messages } = this.state;\r\n    if (!contact?.id) return null;\r\n    // Filter messages for the active contact\r\n    let filtered = messages.filter(\r\n      (m) => m.sender === contact.id || m.receiver === contact.id\r\n    );\r\n    return <Messages user={user} messages={filtered} />;\r\n  };\r\n\r\n  // ------------------- Socket.io Setup & Event Handlers ------------------- //\r\n\r\n  initSocketConnection = () => {\r\n    let socket = socketIO(process.env.REACT_APP_SOCKET, {\r\n      query: 'token=' + Auth.getToken()\r\n    });\r\n    socket.on('connect', () => this.setState({ connected: true }));\r\n    socket.on('disconnect', () => this.setState({ connected: false }));\r\n    socket.on('data', this.onData);\r\n    socket.on('new_user', this.onNewUser);\r\n    socket.on('update_user', this.onUpdateUser);\r\n    socket.on('message', this.onNewMessage);\r\n    socket.on('user_status', this.updateUsersState);\r\n    socket.on('typing', this.onTypingMessage);\r\n    socket.on('error', this.onSocketError);\r\n    this.setState({ socket });\r\n  };\r\n\r\n  /**\r\n   * Server sent user/contacts/messages data after connection.\r\n   */\r\n  onData = (user, contacts, messages, users) => {\r\n    const contact = contacts[0] || {};\r\n    this.setState({ messages, contacts, user, contact }, () => {\r\n      this.updateUsersState(users);\r\n    });\r\n  };\r\n\r\n  onNewUser = (user) => {\r\n    let contacts = [...this.state.contacts, user];\r\n    this.setState({ contacts });\r\n  };\r\n\r\n  onUpdateUser = (updatedUser) => {\r\n    // If current user updated, reflect changes\r\n    if (this.state.user?.id === updatedUser.id) {\r\n      this.setState({ user: updatedUser });\r\n      Auth.setUser(updatedUser);\r\n      return;\r\n    }\r\n    // Otherwise, update that user in contacts\r\n    let contacts = this.state.contacts.map((c) =>\r\n      c.id === updatedUser.id ? { ...updatedUser, status: c.status } : c\r\n    );\r\n    this.setState({ contacts });\r\n    // If it's the contact being viewed, update it\r\n    if (this.state.contact?.id === updatedUser.id) {\r\n      this.setState({ contact: updatedUser });\r\n    }\r\n  };\r\n\r\n  onNewMessage = (message) => {\r\n    // If the message is from the active contact, mark it seen\r\n    if (message.sender === this.state.contact?.id) {\r\n      this.setState({ typing: false });\r\n      this.state.socket.emit('seen', this.state.contact.id);\r\n      message.seen = true;\r\n    }\r\n    this.setState((prev) => ({ messages: [...prev.messages, message] }));\r\n  };\r\n\r\n  onTypingMessage = (sender) => {\r\n    if (this.state.contact?.id !== sender) return;\r\n    this.setState({ typing: sender });\r\n    clearTimeout(this.state.timeout);\r\n    const timeout = setTimeout(this.typingTimeout, 3000);\r\n    this.setState({ timeout });\r\n  };\r\n\r\n  onSocketError = (err) => {\r\n    if (err === 'auth_error') {\r\n      Auth.logout();\r\n      this.props.history.push('/login');\r\n    }\r\n  };\r\n\r\n  typingTimeout = () => this.setState({ typing: false });\r\n\r\n  /**\r\n   * Send message to server (Socket.io).\r\n   */\r\n  sendMessage = (message) => {\r\n    if (!this.state.contact?.id) return;\r\n    message.receiver = this.state.contact.id;\r\n    this.setState((prev) => ({ messages: [...prev.messages, message] }));\r\n    this.state.socket.emit('message', message);\r\n  };\r\n\r\n  /**\r\n   * Indicate user is typing.\r\n   */\r\n  sendType = () => {\r\n    if (this.state.contact?.id) {\r\n      this.state.socket.emit('typing', this.state.contact.id);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Logout user.\r\n   */\r\n  logout = () => {\r\n    this.state.socket.disconnect();\r\n    Auth.logout();\r\n    this.props.history.push('/');\r\n  };\r\n\r\n  /**\r\n   * Update user statuses (online/offline timestamps).\r\n   */\r\n  updateUsersState = (users) => {\r\n    let contacts = this.state.contacts.map((c) => {\r\n      if (users[c.id]) {\r\n        return { ...c, status: users[c.id] };\r\n      }\r\n      return c;\r\n    });\r\n    this.setState({ contacts });\r\n\r\n    let contact = this.state.contact;\r\n    if (users[contact.id]) {\r\n      contact.status = users[contact.id];\r\n      this.setState({ contact });\r\n    }\r\n  };\r\n}\r\n\r\nexport default Chat;\r\n"]},"metadata":{},"sourceType":"module"}