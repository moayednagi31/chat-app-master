(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{107:function(e,t,a){},182:function(e,t,a){"use strict";a.r(t);var n=a(2),s=a.n(n),c=a(32),o=a.n(c),r=(a(107),a(108),a(12)),i=a(13),l=a(15),d=a(14),u=a(23),h=a(11),m=a(22),g=a(102),j=a(1),f=function(e){var t=e.component,a=e.can,n=void 0===a?function(){return!0}:a,s=e.redirect,c=Object(g.a)(e,["component","can","redirect"]);return Object(j.jsx)(h.b,Object(m.a)(Object(m.a)({},c),{},{render:function(e){return n()?Object(j.jsx)(t,Object(m.a)({},e)):Object(j.jsx)(h.a,{to:s})}}))},p=a(189),b=a(184),O=a(98),C=a(197),v=a(190),x=a(191),S=a(192),w=a(183),k=function(e){return e.error?Object(j.jsx)(w.a,{color:"danger",children:e.error}):""},N=function(e){var t=e.src?"uploads/".concat(e.src):"data:image/png;base64,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";return Object(j.jsx)("img",{src:e.file||t,className:"img-fluid rounded-circle ml-3 avatar",alt:""})},A=function(e){var t;return Object(j.jsxs)(b.a,{className:"heading",children:[Object(j.jsx)(N,{src:null===(t=e.user)||void 0===t?void 0:t.avatar}),Object(j.jsx)("div",{children:"Contacts"}),Object(j.jsx)("div",{className:"mr-auto nav-link",onClick:e.toggle,children:Object(j.jsx)("i",{className:"fa fa-bars"})})]})},T=a(43),y=a(30),I=a.n(y),U=a(185),H=function(e){return Object(j.jsxs)("div",{className:"contact",children:[Object(j.jsxs)("div",{children:[Object(j.jsx)(N,{src:e.contact.avatar}),!0===e.contact.status?Object(j.jsx)("i",{className:"fa fa-circle online"}):""]}),Object(j.jsxs)("div",{className:"w-50",children:[Object(j.jsx)("div",{className:"name",children:e.contact.name}),Object(j.jsx)("div",{className:"small last-message",children:e.message?e.message.content:"Click here to start the conversation"})]}),Object(j.jsxs)("div",{className:"flex-grow-1 text-left",children:[Object(j.jsx)("div",{className:"small text-muted",children:e.message?I()(e.message.date).format("hh:mm a"):""}),e.unseen>0?Object(j.jsx)(U.a,{color:"success",children:e.unseen}):""]})]})},D=a(186),M=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(r.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={search:""},e.onSearch=function(t){return e.setState({search:t.target.value})},e.renderContact=function(t,a){if(t.name.includes(e.state.search)){var n=e.props.messages.filter((function(e){return e.sender===t.id||e.receiver===t.id})),s=n[n.length-1],c=n.filter((function(e){return!e.seen&&e.sender===t.id})).length;return Object(j.jsx)("div",{className:"w-100",onClick:e.props.onChatNavigate.bind(Object(T.a)(e),t),children:Object(j.jsx)(H,{contact:t,message:s,unseen:c})},a)}},e}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return Object(j.jsxs)("div",{className:"list",children:[Object(j.jsx)(b.a,{className:"search",children:Object(j.jsx)(D.a,{onChange:this.onSearch,placeholder:"Search"})}),Object(j.jsx)(b.a,{id:"contacts",children:this.props.contacts.map((function(t,a){return e.renderContact(t,a)}))})]})}}]),a}(s.a.Component),R=a(194),P=a(195),E=a(196),q=a(187),G=Object(h.g)((function(e){var t,a;return Object(j.jsxs)(b.a,{className:"heading m-0 align-items-center w-100",style:{padding:"0.5rem",justifyContent:"space-between"},children:[Object(j.jsxs)("div",{className:"d-flex align-items-center",onClick:e.toggle,style:{cursor:"pointer"},children:[Object(j.jsx)(N,{src:null===(t=e.contact)||void 0===t?void 0:t.avatar}),Object(j.jsxs)("div",{className:"text-left ml-2",children:[Object(j.jsx)("div",{children:(null===(a=e.contact)||void 0===a?void 0:a.name)||""}),Object(j.jsx)("small",{children:e.typing?"Typing now":!0===e.contact.status?"Online now":e.contact.status?I()(e.contact.status).fromNow():""})]})]}),Object(j.jsxs)("div",{className:"d-flex align-items-center",style:{marginLeft:"0.5rem"},children:[Object(j.jsx)(O.a,{color:"success",onClick:function(){console.log("[ChatHeader] Call button clicked"),e.onCall&&e.onCall(e.contact)},className:"mr-2",children:Object(j.jsx)("i",{className:"fa fa-phone"})}),Object(j.jsxs)(R.a,{children:[Object(j.jsx)(P.a,{tag:"a",className:"nav-link",style:{cursor:"pointer"},children:Object(j.jsx)("i",{className:"fa fa-ellipsis-v"})}),Object(j.jsxs)(E.a,{children:[Object(j.jsx)(q.a,{onClick:function(){return e.history.push("/password")},children:"Change Password"}),Object(j.jsx)(q.a,{divider:!0}),Object(j.jsx)(q.a,{onClick:e.logout,children:"Logout"})]})]})]})]})})),B=function(e){return Object(j.jsx)("div",{className:e.message.outgoing?"message-item":"message-item incoming",children:Object(j.jsx)("div",{className:"d-flex flex-row",children:Object(j.jsxs)("div",{className:"body m-1 mr-2",children:[Object(j.jsx)("div",{children:e.message.content}),Object(j.jsx)("span",{className:"small text-muted",children:I()(e.message.date).format("hh:mm a | MMM D")})]})})})},L=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(r.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).renderMessage=function(t,a){return t.outgoing=t.receiver!==e.props.user.id,Object(j.jsx)(B,{message:t},a)},e}return Object(i.a)(a,[{key:"render",value:function(){return Object(j.jsx)("div",{id:"messages",children:this.props.messages.map(this.renderMessage)})}}]),a}(s.a.Component),V=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(r.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={message:"",lastType:!1},e.onChange=function(t){return e.setState({message:t.target.value})},e.onSend=function(t){if(e.state.message){var a={content:e.state.message,date:(new Date).getTime()};e.props.sender(a),e.setState({message:""})}},e.onKeyDown=function(t){"Enter"!==t.key||t.shiftKey?(!e.state.lastType||I()()-e.state.lastType>2e3)&&(e.setState({lastType:I()()}),e.props.sendType()):(e.setState({lastType:!1}),e.onSend(),t.preventDefault())},e}return Object(i.a)(a,[{key:"render",value:function(){return Object(j.jsxs)("div",{id:"send-message",children:[Object(j.jsx)(D.a,{type:"textarea",rows:"1",onChange:this.onChange,onKeyDown:this.onKeyDown,value:this.state.message,placeholder:"Write your message here"}),Object(j.jsx)("i",{className:"fa fa-send text-muted px-3 send",onClick:this.onSend})]})}}]),a}(s.a.Component),Z=function(e){return Object(j.jsxs)("div",{className:e.open?"side-profile open":"side-profile",children:[Object(j.jsxs)(b.a,{className:"heading",children:[Object(j.jsx)("div",{className:"mr-2 nav-link",onClick:e.toggle,children:Object(j.jsx)("i",{className:"fa fa-arrow-right"})}),Object(j.jsx)("div",{children:e.contact.name})]}),Object(j.jsxs)("div",{className:"d-flex flex-column overflow-auto",children:[Object(j.jsx)(N,{src:e.contact.avatar}),Object(j.jsxs)("div",{className:"bg-white px-3 py-2",children:[Object(j.jsx)("label",{className:"text-muted",children:"Status Message"}),Object(j.jsx)("p",{children:e.contact.about?e.contact.about:"Hello, I am using chat me"})]})]})]})},F=a(188),X=a(18),J=a.n(X),K=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(e){var n;Object(r.a)(this,a),(n=t.call(this,e)).showFileUpload=function(){return n.fileUpload.current.click()},n.onImageChange=function(e){e.target.files&&e.target.files[0]&&n.setState({image:URL.createObjectURL(e.target.files[0]),avatar:e.target.files[0]})},n.onChange=function(e){return n.setState({[e.target.name]:e.target.value,error:null})},n.onSubmit=function(e){e.preventDefault();var t=new FormData;t.append("name",n.state.name),t.append("about",n.state.about),n.state.avatar&&t.append("avatar",n.state.avatar,n.state.avatar.name),J.a.post("/api/account",t).then(n.props.toggle).catch((function(e){var t,a;n.setState({error:(null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||"An error occurred."})}))},n.onClose=function(){var e=n.props.user||{};n.setState({image:null,avatar:null,name:e.name||"",about:e.about||""}),n.props.toggle()};var c=e.user||{};return n.state={name:c.name||"",about:c.about||"",image:null,avatar:null,error:null},n.fileUpload=s.a.createRef(),n}return Object(i.a)(a,[{key:"render",value:function(){var e;return Object(j.jsxs)("div",{className:this.props.open?"side-profile open":"side-profile",children:[Object(j.jsxs)(b.a,{className:"heading",children:[Object(j.jsx)("div",{className:"mr-2 nav-link",onClick:this.onClose,children:Object(j.jsx)("i",{className:"fa fa-arrow-right"})}),Object(j.jsx)("div",{children:"Profile"})]}),Object(j.jsx)("div",{className:"d-flex flex-column",style:{overflow:"auto"},children:Object(j.jsxs)(F.a,{onSubmit:this.onSubmit,children:[Object(j.jsx)(k,{error:this.state.error}),Object(j.jsx)("div",{className:"text-center",onClick:this.showFileUpload,children:Object(j.jsx)(N,{src:null===(e=this.props.user)||void 0===e?void 0:e.avatar,file:this.state.image})}),Object(j.jsx)("input",{type:"file",ref:this.fileUpload,onChange:this.onImageChange,className:"d-none"}),Object(j.jsxs)("div",{className:"bg-white px-4 py-2",children:[Object(j.jsx)("label",{className:"text-muted",children:"Name"}),Object(j.jsx)(D.a,{value:this.state.name,name:"name",onChange:this.onChange,required:!0,autoComplete:"off"})]}),Object(j.jsxs)("div",{className:"bg-white px-3 py-2",children:[Object(j.jsx)("label",{className:"text-muted",children:"Status Message"}),Object(j.jsx)(D.a,{value:this.state.about,name:"about",onChange:this.onChange,required:!0,autoComplete:"off"})]}),Object(j.jsx)("div",{className:"bg-white px-3 py-2",children:Object(j.jsx)(O.a,{block:!0,className:"mt-3",children:"Save"})})]})})]})}}]),a}(s.a.Component),Y=a(101),Q=a.n(Y),z={init:function(){var e=JSON.parse(localStorage.getItem("user"));J.a.defaults.headers.common.Authorization=null!==e?e.token:""},login:function(e){localStorage.setItem("user",JSON.stringify(e)),J.a.defaults.headers.common.Authorization=e.token},logout:function(){delete J.a.defaults.headers.common.Authorization,localStorage.removeItem("user")},auth:function(){return null!==localStorage.getItem("user")},guest:function(){return null===localStorage.getItem("user")},getToken:function(){var e=JSON.parse(localStorage.getItem("user"));return null!==e?e.token:""},setUser:function(e){var t=JSON.parse(localStorage.getItem("user"));e.token=t.token,localStorage.setItem("user",JSON.stringify(e))}},W=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(r.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={contacts:[],contact:{},userProfile:!1,profile:!1,connected:!1,messages:[],typing:!1,timeout:null,user:null,callState:"idle",incomingCallModal:!1,callerInfo:null,localStream:null,remoteStream:null,peerConnection:null,pendingOffer:null},e.initSocketConnection=function(){var t=Q()("ws://localhost:3001",{query:"token="+z.getToken()});t.on("connect",(function(){console.log("[CHAT] Socket connected"),e.setState({connected:!0})})),t.on("disconnect",(function(){console.log("[CHAT] Socket disconnected"),e.setState({connected:!1})})),t.on("data",e.onData),t.on("message",e.onNewMessage),t.on("user_status",e.updateUsersState),t.on("typing",e.onTypingMessage),t.on("error",e.onSocketError),t.on("incomingCall",(function(t){console.log("[CHAT] Incoming call from:",t),e.setState({callState:"receiving",incomingCallModal:!0,callerInfo:t}),e.state.contact.id&&e.state.contact.id===t.from||e.setState({contact:Object(m.a)(Object(m.a)({},e.state.contact),{},{id:t.from,name:t.callerName})})})),t.on("offer",(function(t){var a=t.sdp,n=t.caller;console.log("[CHAT] Received offer from:",n),e.state.peerConnection?e.handleOffer(a,n):(console.log("[CHAT] No peerConnection yet. Storing pendingOffer..."),e.setState({pendingOffer:{sdp:a,caller:n}}))})),t.on("answer",(function(t){var a=t.sdp,n=t.callee;if(console.log("[CHAT] Received answer from:",n),e.state.peerConnection){var s=new RTCSessionDescription(a);e.state.peerConnection.setRemoteDescription(s).then((function(){console.log("[CHAT] Remote description set for answer, callState = inCall"),e.setState({callState:"inCall"})})).catch((function(e){return console.error("[CHAT] Error setting remote desc (answer)",e)}))}})),t.on("iceCandidate",(function(t){var a=t.candidate,n=t.from;console.log("[CHAT] Received ICE candidate from:",n),e.state.peerConnection&&a&&e.state.peerConnection.addIceCandidate(new RTCIceCandidate(a)).catch((function(e){return console.error("[CHAT] Error adding ICE candidate",e)}))})),t.on("hangUp",(function(){console.log("[CHAT] Call ended by remote"),e.endCall()})),e.setState({socket:t})},e.handleOffer=function(t,a){console.log("[CHAT] handleOffer => Setting remote desc & creating answer...");var n=new RTCSessionDescription(t);e.state.peerConnection.setRemoteDescription(n).then((function(){return console.log("[CHAT] Remote description set (offer). Creating answer..."),e.state.peerConnection.createAnswer()})).then((function(t){console.log("[CHAT] Created answer, setting local desc and sending..."),e.state.peerConnection.setLocalDescription(t),e.state.socket.emit("answer",{sdp:t,target:a}),e.setState({callState:"inCall"})})).catch((function(e){return console.error("[CHAT] Error handling offer->answer",e)}))},e.initiateCall=function(t){var a;t.id&&(console.log("[CHAT] Initiating call with contact:",t.id),e.setState({callState:"calling",contact:t}),e.state.socket.emit("callUser",{recipientId:t.id,callerName:(null===(a=e.state.user)||void 0===a?void 0:a.username)||"Unknown Caller"}),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(a){console.log("[CHAT] Got localStream, tracks:",a.getAudioTracks()),e.setState({localStream:a});var n=e.createPeerConnection();a.getTracks().forEach((function(e){console.log("[CHAT] Adding local track:",e.label),n.addTrack(e,a)})),n.createOffer().then((function(a){console.log("[CHAT] Created offer, setting local desc"),n.setLocalDescription(a),console.log("[CHAT] Sending offer to server..."),e.state.socket.emit("offer",{sdp:a,target:t.id})})).catch((function(e){return console.error("[CHAT] Offer creation error",e)})),e.setState({peerConnection:n})})).catch((function(e){return console.error("[CHAT] getUserMedia error",e)})))},e.acceptCall=function(){var t;console.log("[CHAT] Accepting call from:",e.state.callerInfo),e.setState({incomingCallModal:!1,callState:"inCall"});var a=null===(t=e.state.callerInfo)||void 0===t?void 0:t.from;!a||e.state.contact.id&&e.state.contact.id===a||e.setState({contact:Object(m.a)(Object(m.a)({},e.state.contact),{},{id:a,name:e.state.callerInfo.callerName})}),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(t){console.log("[CHAT] Got localStream (callee), tracks:",t.getAudioTracks()),e.setState({localStream:t});var a=e.createPeerConnection();t.getTracks().forEach((function(e){console.log("[CHAT] Callee adding local track:",e.label),a.addTrack(e,t)})),e.setState({peerConnection:a},(function(){if(e.state.pendingOffer){var t=e.state.pendingOffer,a=t.sdp,n=t.caller;e.handleOffer(a,n),e.setState({pendingOffer:null})}}))})).catch((function(e){return console.error("[CHAT] Error accessing mic (callee)",e)}))},e.rejectCall=function(){console.log("[CHAT] Rejecting call from:",e.state.callerInfo),e.setState({incomingCallModal:!1,callState:"idle",callerInfo:null,pendingOffer:null})},e.createPeerConnection=function(){console.log("[CHAT] Creating RTCPeerConnection...");var t=new RTCPeerConnection({iceServers:[{urls:"stun:stun1.l.google.com:19302"}]});return t.onicecandidate=function(t){if(t.candidate){var a=e.state.contact.id||e.state.callerInfo&&e.state.callerInfo.from;console.log("[CHAT] Sending ICE candidate to:",a),e.state.socket.emit("iceCandidate",{candidate:t.candidate,target:a})}else console.log("[CHAT] ICE gathering complete (no more candidates)")},t.ontrack=function(t){console.log("[CHAT] ontrack => remote track label:",t.track.label),e.setState({remoteStream:t.streams[0]})},t.onconnectionstatechange=function(){var a=t.connectionState;console.log("[CHAT] PeerConnection state:",a),"disconnected"!==a&&"failed"!==a&&"closed"!==a||(console.log("[CHAT] PeerConnection ended, calling endCall()"),e.endCall())},t},e.endCall=function(){console.log("[CHAT] endCall invoked");var t=e.state,a=t.socket,n=t.contact,s=t.callerInfo,c=t.peerConnection,o=t.localStream,r=t.callState,i=n.id||s&&s.from;"calling"!==r&&"inCall"!==r||(console.log("[CHAT] Emitting hangUp to target:",i),a.emit("hangUp",{target:i})),c&&(console.log("[CHAT] Closing peerConnection..."),c.close()),o&&(console.log("[CHAT] Stopping localStream tracks"),o.getTracks().forEach((function(e){return e.stop()}))),e.setState({callState:"idle",peerConnection:null,localStream:null,remoteStream:null,callerInfo:null,incomingCallModal:!1,pendingOffer:null})},e.onData=function(t,a,n,s){console.log("[CHAT] onData => user:",t," contacts:",a.length);var c=a[0]||{};e.setState({messages:n,contacts:a,user:t,contact:c},(function(){e.updateUsersState(s)}))},e.onNewMessage=function(t){t.sender===e.state.contact.id&&(e.setState({typing:!1}),e.state.socket.emit("seen",e.state.contact.id),t.seen=!0);var a=e.state.messages.concat(t);e.setState({messages:a})},e.onTypingMessage=function(t){if(e.state.contact.id===t){e.setState({typing:t}),clearTimeout(e.state.timeout);var a=setTimeout((function(){return e.setState({typing:!1})}),3e3);e.setState({timeout:a})}},e.onSocketError=function(t){console.error("[CHAT] Socket error:",t),"auth_error"===t&&(z.logout(),e.props.history.push("/login"))},e.updateUsersState=function(t){var a=e.state.contacts;a.forEach((function(e,n){t[e.id]&&(a[n].status=t[e.id])})),e.setState({contacts:a});var n=e.state.contact;t[n.id]&&(n.status=t[n.id]),e.setState({contact:n})},e.sendMessage=function(t){if(e.state.contact.id){t.receiver=e.state.contact.id;var a=e.state.messages.concat(t);e.setState({messages:a}),e.state.socket.emit("message",t)}},e.sendType=function(){e.state.contact.id&&e.state.socket.emit("typing",e.state.contact.id)},e.logout=function(){console.log("[CHAT] Logging out user"),e.state.socket.disconnect(),z.logout(),e.props.history.push("/")},e.renderChat=function(){var t=e.state,a=t.contact,n=t.user,s=t.messages;if(!a||!a.id)return null;var c=s.filter((function(e){return e.sender===a.id||e.receiver===a.id}));return Object(j.jsx)(L,{user:n,messages:c})},e.onChatNavigate=function(t){console.log("[CHAT] onChatNavigate => switching to contact:",t.id),e.setState({contact:t}),e.state.socket.emit("seen",t.id);var a=e.state.messages.map((function(e){return e.sender===t.id?Object(m.a)(Object(m.a)({},e),{},{seen:!0}):e}));e.setState({messages:a})},e.userProfileToggle=function(){return e.setState({userProfile:!e.state.userProfile})},e.profileToggle=function(){return e.setState({profile:!e.state.profile})},e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.initSocketConnection()}},{key:"render",value:function(){var e=this;return this.state.connected&&this.state.contacts&&this.state.messages?Object(j.jsxs)(b.a,{className:"h-100",children:[Object(j.jsxs)("div",{id:"contacts-section",className:"col-6 col-md-4",children:[Object(j.jsx)(A,{user:this.state.user,toggle:this.profileToggle}),Object(j.jsx)(M,{contacts:this.state.contacts,messages:this.state.messages,onChatNavigate:this.onChatNavigate}),Object(j.jsx)(Z,{contact:this.state.contact,toggle:this.userProfileToggle,open:this.state.userProfile}),Object(j.jsx)(K,{user:this.state.user,toggle:this.profileToggle,open:this.state.profile})]}),Object(j.jsxs)("div",{id:"messages-section",className:"col-6 col-md-8",children:[Object(j.jsx)(G,{contact:this.state.contact,typing:this.state.typing,toggle:this.userProfileToggle,logout:this.logout,onCall:this.initiateCall}),this.renderChat(),Object(j.jsx)(V,{sender:this.sendMessage,sendType:this.sendType}),("calling"===this.state.callState||"inCall"===this.state.callState)&&Object(j.jsx)(O.a,{color:"danger",onClick:this.endCall,className:"mt-2",children:"Hang Up"}),this.state.remoteStream&&Object(j.jsx)("audio",{ref:function(t){t&&e.state.remoteStream&&(console.log("[CHAT] Attaching remoteStream to audio element"),t.srcObject=e.state.remoteStream)},autoPlay:!0})]}),Object(j.jsxs)(C.a,{isOpen:this.state.incomingCallModal,children:[Object(j.jsx)(v.a,{children:"Incoming Call"}),Object(j.jsx)(x.a,{children:this.state.callerInfo&&Object(j.jsxs)("p",{children:[this.state.callerInfo.callerName," is calling..."]})}),Object(j.jsxs)(S.a,{children:[Object(j.jsx)(O.a,{color:"success",onClick:this.acceptCall,children:"Accept"}),Object(j.jsx)(O.a,{color:"secondary",onClick:this.rejectCall,children:"Reject"})]})]})]}):Object(j.jsx)(p.a,{id:"loader",color:"success"})}}]),a}(s.a.Component),_=function(e){return Object(j.jsx)("h3",{children:"The requested page was not found"})},$=(a(96),a.p+"static/media/logo.2e5b0bba.png"),ee=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(r.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={name:"",username:"",password:"",error:""},e.onChange=function(t){return e.setState({[t.target.name]:t.target.value,error:null})},e.onSubmit=function(t){t.preventDefault();var a={name:e.state.name,username:e.state.username,password:e.state.password};J.a.post("/api/auth/register",a).then((function(t){z.login(t.data),e.props.history.push("/")})).catch((function(t){return e.setState({error:t.response.data.message})}))},e}return Object(i.a)(a,[{key:"render",value:function(){return Object(j.jsx)("div",{className:"auth-container",children:Object(j.jsxs)(F.a,{onSubmit:this.onSubmit,children:[Object(j.jsx)("img",{src:$,alt:"Logo"}),Object(j.jsx)("h5",{className:"auth-header",children:"Create a New Account"}),Object(j.jsx)(k,{error:this.state.error}),Object(j.jsx)(D.a,{className:"auth-form-control",value:this.state.name,name:"name",onChange:this.onChange,placeholder:"Name",required:!0}),Object(j.jsx)(D.a,{className:"auth-form-control",value:this.state.username,name:"username",onChange:this.onChange,placeholder:"Username",required:!0}),Object(j.jsx)(D.a,{type:"password",className:"auth-form-control",value:this.state.password,name:"password",onChange:this.onChange,placeholder:"Password",required:!0}),Object(j.jsx)(O.a,{className:"auth-button",block:!0,children:"Create"}),Object(j.jsx)("small",{className:"auth-footer",children:Object(j.jsx)(u.b,{to:"/login",children:"Login"})}),Object(j.jsxs)("p",{className:"auth-footer",children:["\xa9 ",(new Date).getFullYear()]})]})})}}]),a}(s.a.Component),te=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(r.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={username:"",password:"",error:""},e.onChange=function(t){return e.setState({[t.target.name]:t.target.value,error:null})},e.onSubmit=function(t){t.preventDefault();var a={username:e.state.username,password:e.state.password};J.a.post("/api/auth",a).then((function(t){z.login(t.data),e.props.history.push("/")})).catch((function(t){return e.setState({error:t.response.data.message})}))},e}return Object(i.a)(a,[{key:"render",value:function(){return Object(j.jsx)("div",{className:"auth-container",children:Object(j.jsxs)(F.a,{onSubmit:this.onSubmit,children:[Object(j.jsx)("img",{src:$,alt:"Logo"}),Object(j.jsx)("h5",{className:"auth-header",children:"Login"}),Object(j.jsx)(k,{error:this.state.error}),Object(j.jsx)(D.a,{className:"auth-form-control",value:this.state.username,name:"username",onChange:this.onChange,placeholder:"Username",required:!0}),Object(j.jsx)(D.a,{type:"password",className:"auth-form-control",value:this.state.password,name:"password",onChange:this.onChange,placeholder:"Password",required:!0}),Object(j.jsx)(O.a,{className:"auth-button",block:!0,children:"Login"}),Object(j.jsx)("small",{className:"auth-footer",children:Object(j.jsx)(u.b,{to:"/register",children:"Create a new account"})}),Object(j.jsxs)("p",{className:"auth-footer",children:["\xa9 ",(new Date).getFullYear()]})]})})}}]),a}(s.a.Component),ae=a(193),ne=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(r.a)(this,a);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={password:"",newPassword:""},e.onChange=function(t){return e.setState({[t.target.name]:t.target.value,error:null})},e.onSubmit=function(t){t.preventDefault();var a={password:e.state.password,newPassword:e.state.newPassword};J.a.post("/api/account/password",a).then((function(t){e.props.history.push("/")})).catch((function(t){e.setState({error:t.response.data.message})}))},e}return Object(i.a)(a,[{key:"render",value:function(){return Object(j.jsx)(ae.a,{className:"auth col-lg-3 col-sm-6",children:Object(j.jsxs)(F.a,{onSubmit:this.onSubmit,children:[Object(j.jsx)("img",{src:$,alt:"",width:"200"}),Object(j.jsx)("h5",{className:"mb-4",children:"Change Password"}),Object(j.jsx)(k,{error:this.state.error}),Object(j.jsx)(D.a,{type:"password",value:this.state.password,name:"password",onChange:this.onChange,placeholder:"Current Password",required:!0}),Object(j.jsx)(D.a,{type:"password",value:this.state.newPassword,name:"newPassword",onChange:this.onChange,placeholder:"New Password",required:!0}),Object(j.jsx)(O.a,{block:!0,className:"mb-3",children:"Change"}),Object(j.jsx)("small",{children:Object(j.jsx)(u.b,{to:"/",children:"Back"})}),Object(j.jsxs)("p",{className:"m-3 mb-3 text-muted",children:["\xa9 ",(new Date).getFullYear()]})]})})}}]),a}(s.a.Component),se=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(r.a)(this,a),n=t.call(this,e),z.init(),n}return Object(i.a)(a,[{key:"render",value:function(){return Object(j.jsx)("div",{id:"main-container",className:"container-fluid",children:Object(j.jsx)(u.a,{children:Object(j.jsxs)(h.d,{children:[Object(j.jsx)(f,{path:"/",exact:!0,component:W,can:z.auth,redirect:"/login"}),Object(j.jsx)(f,{path:"/password",component:ne,can:z.auth,redirect:"/login"}),Object(j.jsx)(f,{path:"/password",component:ne,can:z.auth,redirect:"/login"}),Object(j.jsx)(f,{path:"/register",component:ee,can:z.guest,redirect:"/"}),Object(j.jsx)(f,{path:"/Login",component:te,can:z.guest,redirect:"/"}),Object(j.jsx)(f,{component:_})]})})})}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(Object(j.jsx)(se,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},96:function(e,t,a){}},[[182,1,2]]]);
//# sourceMappingURL=main.ca8f67a8.chunk.js.map